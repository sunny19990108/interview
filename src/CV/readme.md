## 针对简历上写的内容准备的

## 自我介绍
简历上伴鱼的经历写了一年
在校接触前端，在实验室跟着老师学习，做项目
后来出去实习
毕业后继续从事前端开发的工作

## jest
单元测试

__test__
    xxx.test.ts

npm run test page/Component/BatchUpload.test.ts --watch
npm run test page/Component/BatchUpload.test.ts --coverage 可以查看测试覆盖率


- 匹配器
toBe()
toEqual()
toBeTruthy()
toMatch()

- 测试异步代码
当我们的test函数中出现了异步回调函数时，可以给test函数传入一个 done 参数，它是一个函数类型的参数。如果test函数传入了done，jest就会等到 done 被调用才会结束当前的test case，如果 done 没有被调用，则该test自动不通过测试。

- 模拟函数
jest.fn： 模拟一个函数。 所有的 mock 函数都有这个特殊的 .mock属性，它保存了关于此函数如何被调用、调用时的返回值的信息。
jest.mock： 模拟一个模块，比如一个方法中有 axios请求，为测试该方法而不实际调用 API (使测试缓慢与脆弱)，我们可以用 jest.mock(...) 函数自动模拟 axios 模块。

## watermark 
开源贡献，一个开源的为DOM 对象添加水印的插件，效果类似于企业微信聊天框里面的水印或者在wiki里面加盖的满屏水印
原理：pointer-events事件穿透属性，Shadow DOM(影子DOM)，opacity等

- 创建水印的外壳 
创建一个 div，然后` shadowRoot = div.attachShadow() `当水印的外壳（水印在shadow dom 里面）

- 将 shadow dom 插入到传入的水印父元素或者body 上

- 创建水印
每个水印文本都是一个div，绝对定位在水印的外壳元素上
根据传入（或默认）的配置参数：水印宽、高、x轴间距、y轴间距、父元素 计算出每个水印文本的position 的left 和 top 值
把left、top、以及一些其他属性赋给水印文本元素，并将文本元素加到外壳元素上` shadowRoot.appendChild(mask_div);`

- MutationObserver 监听水印外壳尺寸变化，尺寸有变就重新计算水印

我遇到的问题：
给水印指定了父元素，父元素里面有很多可以展开收起的卡片，卡片收起展开的时候都要重新计算水印，发现每次计算的水印的文本位置都不太一样且没有规律
看了源码发现 水印文本的top 的计算公式有点问题（多加了一块距离：(page_height - allWatermarkHeight) / 2），直接把代码拷贝到本地，改了。

## 安全漏洞
移动端页面：一级页面里面有个按钮 我的薪酬，里面二级页面有两个：员工工资单明细页、员工工资单记录页、社保公积金明细数据页，每次进入二级页面都要先输入密码，输入以后再在这几个二级页面之间来回跳转就不需要密码了。

漏洞：背景是在一个小应用里面的一级页面，进入某个二级页面，需要输入密码验证，每次从一级页面进入这个二级页面都需要密码验证。输入密码验证之前因为是在小应用里面，用户一直是登录的状态。先输入密码验证，然后退出，在localStorage 里面写入 比如是：`login: true;`（其实不是login 更加复杂一些） 再点可以直接进入二级页面；或者带上登录时token直接去访问具体的接口也能拿到相应的数据。
原因：进入二级页面跳转到登录页，或者设置密码页面，这个逻辑大部分是前端控制的，后端那边其实不知道用户什么时候进入了这个页面，什么时候离开了这个页面，这也是直接去访问具体的街口也能拿到相应的数据能拿到数据的原因。
最终解决方案： 后端敏感的接口（薪资，社保公积金明细）都加了安全限制，输入密码后5分钟内可以访问， 5 分钟后再请求接口，接口返回错误码，前端根据错误码判断是正常进入二级页面还是去登录。

## 线上bug
1、新增一条数据的model、修改一条数据的model、由于model 的样式差不多，使用的一个；先修改一条数据再新增一条数据 新增的model 里面带着上一条操作的某些数据；
原因：修改数据完没有清除model里面的数据都重置为空。
解决： 把需要置为初始值的一些数据都抽离出来，写一个初始化方法，在需要的地方调用。

2、某些特别极端的case 下有一个下拉里面一行没有数据

reduce 回调函数里面totalRule(所有规则) 里面有当前页面中这条规则时就替换total里面的（如果最后一条数据命中这里没有对应的return），没有就加入到total 里面。还有很多其他逻辑；


## 优化体验
缩小窗口页面会出现一些滚动条，不同的页面滚动条表现不一致，有的页面比较美观只在最底部有一条滚动条。有一些页面出现两条，甚至三条滚动条。
优化后效果： 页面都是在最底有一条滚动条

遇到的问题：
优化主要是改一些元素的min-width, 以及给适当的元素设置overflow-scroll 
优化完后，有个页面快速缩放的时候页面中部闪出一条滚动条，停止缩放后就消失了。慢慢缩放不会出现滚动条。
原因：
页面中有一个table, table 中有涉及很多计算元素的挂载卸载，有性能问题。快速缩放的时候计算速度赶不上页面变化的速度，快读缩放页面，table宽度还没变小就出现了滚动条。
解决：给table包一个父元素，设置width: 100%; overflow: hidden;
当然最好是解决掉table的性能问题，但这里就先这样改了。

## 遇到的问题
1、社保缴纳，缴费试算，用户输入缴纳基数后，后端数据还没落库，这时候预算一下具体各项社保、公积金需要缴纳多少以及缴纳合计。
这个计算放在前端：但js计算小数是有问题的（原因：十进制的0.1和0.2都会被转换成二进制，但由于浮点数用二进制表达时是无穷的），比如：0.1+0.2，只能自己实现加法、乘法或者把基数传给后端让后端算。最后是前端算的。

自己实现：将数字转换为字符串，抹掉小数点，并记录小数位数，先用整数计算最后再除以相应的倍数。

2、需求中遇到的问题，逻辑性的问题，画流程图，不仅是本次需求的流程还有需求上下游的。

3、进入自动弹出键盘。autofocus 有在ios上面默认会被限制，可以在 app 层面设置，或者自己模拟键盘，进入页面执行一些方法呼出键盘。

<!-- 4、超过两行显示省略号和展开收起。
css: 有兼容性问题，可能出现文字盖住省略号的情况。
display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 2;

js:
拷贝文字的父容器(样式)，让文字不换行，看宽度是正常情况的多少倍就是多少行。 -->
4、内嵌在app中的页面，本地调试可以，发布测试环境在app上面看接口请求有问题，因为app上将我们的请求都包装了一遍；


1、外层元素高度是0 ，靠内层元素撑开
但是内层元素自己高度多高也不清楚，
这时候设置内层元素高度100%，没有效果，那么怎样才有效果呢？

【定位】给内层元素设置position: absolute; 

2、title列是自适应的  它display是flex  怎么给文字溢出省略？
width: 0;

## 技术分享
从业务出发：先讲业务，再讲一些特别的代码，有好的也有我感觉不好的，业务比较复杂逻辑非常多
薪酬业务： 定薪、薪资异动、停薪、算薪、交税、社保/公积金计算、缴纳、薪资支出统计对比
薪资等级表、是否和人事职级相关联
薪资项 和考勤关联、和组织关联
核算规则管理，是否接口计税，（系统根据用户设置的规则帮忙算税，或者自己手动录入）
参保方案管理（基数、比例），参保地管理、增员、减员

1、比如我的工资入口有三个，邮件、IM消息、移动端/pc的应用中。 
其中：IM消息内嵌了飞书、微信、钉钉三端，三端内嵌的逻辑各不相同。

其中有一端的对接逻辑写的不怎么好: 点击IM消息要跳转的页面地址直接给公共平台写在了钉钉提供的sdk 的 url中，（没有业务方给公共平台传递url 的过程）
直接写虽然简单粗暴，但如果这个url 要改，业务方可能不知道要去哪里改，业务方的代码里也看到相关的配置。
所以应该不同业务对应不同的key 公共平台把不同的key 相对应的url 传给钉钉。

好的地方： 给页面做了统一的是否需要登录的管理，因为业务比较多，导致一个页面可能在pc端使用，可能在移动端使用。移动端的是在app内，用户肯定登录了
pc端cookie里就没有用户登录的信息了，所以基于这点这些页面接口都有两套，一套有token的，一套没有token但可以根据另一个id查询到结果的接口。
这样的页面多了显得有点乱，写的人代码水平不一，所以有一个兜底，如果页面需要免登录获取数据的功能，就配置在一个数据里面。在一个ajax请求时有一层拦截，判断是否是免登录的，如果不是那么如果没有带token就不去请求。

## 文档沉淀
新人文档
技术分享后的文档沉淀
平时遇到一些不好解决的问题写博客

## 项目整体架构/数据管理

## canvas
- 微信分享活动生成活动卡片 
qrcodejs2 + html2canvas 生成带二维码的活动海报
qrcodejs2 生成二维码到对应的html结构上去，html2canvas 根据html结构生成图片data-url 插入到一个img 标签的url上
https://juejin.cn/post/6976243185341169677

可能的问题：
https://juejin.cn/post/6844903626205298701

1、生成的图片上文字部分是空白
不支持文字移除隐藏相关的几个属性，
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
会导致生成时忽略文字部分

2、生成的图片里面为什么缺失微信头像或其他图片
原因：跨域问题,即便是canvas的画布中对于图片的域也是有要求的
解决：html2canvas 配置项中配置 useCORS: true;
img标签增加(图片请求发起时增加) crossOrigin='anonymous'
图片服务器配置Access-Control-Allow-Origin 或使用代理，让网站与图片同源。

3、生成的图片模糊不清且有锯齿瑕疵怎么办
html2canvas 配置项：scale： window.devicePixelRatio || 1;  // 设备像素比

但是缩放之后清晰度变高，但会导致体积太大，比如生成的海报大于5M，某些浏览器保存不了。。
https://segmentfault.com/q/1010000040727024
解决：
(1.减少 DOM 规模，降低html2canvas递归遍历的计算量。
(2.压缩图片素材本身的体积，使用 tinypng 或 ImageOptim 等工具压缩素材。
(3.传入合适的scale值以缩放 canvas 画布。通常情况下 2~3 倍就已经满足一般的场景，不必要传入过大的放大倍数。
(4.图片资源转 blob，可将图片资源本地化，避免了生成快照时 html2canvas 的二次图片加载处理，同时所生成的资源链接具备 URL 长度较短等优势。

4、html2canvas 节点多时有延时，截图比较慢
客户端没多少能做的，只能是加loading 尽量优化体验
服务端截图，使用无头chrome在服务器上渲染页面后截图，再传回客户端

5、什么是canvas污染？
https://juejin.cn/post/6844904084760166407
“将一张跨域的图片绘制到 canvas 上，这个 canvas 就是被污染的，此时无法读取该 canvas 的数据。”
原因：浏览器同源策略
为什么浏览器会有同源策略？
为了限制其他源文档或脚本与当前源的资源进行交互。主要有两个地方：一个是 iframe 节点访问控制，如果没有同源策略限制的话，iframe 可以随意访问其他非同源 iframe 的 dom 节点，如钓鱼网站嵌套了一个银行网站的 iframe ，从外部就可以读取到内部密码输入框的值。另一个是 http 响应控制，如果没有同源策略限制的话，在第三方网站直接对其他网站发起请求，可以读取到响应，这样就可以获取用户的个人信息，造成隐私泄露。


- 课后题讲解画板
classroom2.0 主要页面分三部分：课件（容器中判断使用什么（图片，视频）组件去渲染；同步切换页码动作：轮询）、画板（发布订阅模式实现多端同步）、音视频框框（web端调用js-bridge,app端调第三方sdk(音视频通话sdk 腾讯、即时、阿里)）

参考：文章
https://juejin.cn/post/6844903788998836231
https://zhuanlan.zhihu.com/p/58860041

画板： 画画，改变画笔颜色，改变画笔粗细，橡皮擦，撤销重做
画画： 监听鼠标事件，鼠标按下把画画状态改成true,在鼠标按下的位置画点，鼠标移动，把点记录下来并画出来，并用线将点连接起来，松开鼠标把画画状态改成false
橡皮擦：监听鼠标事件 + context.clearRect() + clip 裁剪（clearRect默认是方形的，需要裁剪为圆形）
清屏： 清空canvas画布
改变画笔粗细： 有一个方法实现画线功能，里面有画线的各种配置项，改变 context.lineWidth 
改变画笔颜色： ctx.strokeStyle = 'black';
<!-- 撤销重做： 维护 canvasHistory 数组 里面维护了每次的canvas.toDataURL() -->












